
# initial setup ---------

# xdph
env = XDG_FILE_MANAGER,thunar

# wayland
env = WLR_NO_HARDWARE_CURSORS,1
env = WLR_DRM_NO_ATOMIC,1
env = WLR_DRM_DEVICES,/dev/dri/card1,/dev/dri/card0
env = AQ_NO_MODIFIERS,1

# vulkan
env = AMD_VULKAN_ICD,RADV
env = RADV_PERFTEST,gpl
env = __GL_SHADER_DISK_CACHE,1
env = __GL_SHADER_DISK_CACHE_PATH,$HOME/.cache/mesa_shader_cache

# video drivers
env = SDL_VIDEODRIVER,wayland
env = LIBVA_DRIVER_NAME,radeonsi
env = VDPAU_DRIVER,radeonsi
env = MESA_LOADER_DRIVER_OVERRIDE,radeonsi

# qt
env = QT_AUTO_SCREEN_SCALE_FACTOR,1

# ozone
env = ELECTRON_USE_OZONE,1
env = OZONE_PLATFORM,wayland

# mozilla
env = MOZ_ENABLE_WAYLAND,1

# caelestia (shell)
env = CAELESTIA_WALLPAPERS_DIR,/home/indigo/Pictures/Wallpapers

# GTK
env = GDK_SCALE,1
env = GDK_DPI_SCALE,1

# other
env = PROTON_ENABLE_WAYLAND,1
env = _JAVA_AWT_WM_NONREPARENTING,1

# monitor setup
monitor = DP-2, preferred, 0x0, 1
monitor = DP-1, preferred, auto-left, 1, transform, 1
monitor = HDMI-A-1, preferred, auto-right, 1

# keybinds ----------
bind = Super, A, global, caelestia:launcher
bind = Ctrl+Super+Alt, D, exec, /home/indigo/.config/caelestia/scripts/monitordupe.sh # toggle duplicating main monitor on third monitor
bind = Super+Alt+Shift, W, exec, fish /home/indigo/windows.sh
bind = Super+Shift, D, exec, fish -c "curl -X POST https://homeassistant.indiserver.internal/api/webhook/toggle-office-tv-input-A6eYSi81u_RhFBGKfzws7sXA"
bind = Super, N, exec, caelestia shell drawers toggle sidebar
bind = Super, Space, exec, circle-to-search --live
bind = Super+Shift, W, exec, chromium

# switch workspaces
bind = Super, 1, focusworkspaceoncurrentmonitor, 1
bind = Super, 2, focusworkspaceoncurrentmonitor, 2
bind = Super, 3, focusworkspaceoncurrentmonitor, 3
bind = Super, 4, focusworkspaceoncurrentmonitor, 4
bind = Super, 5, focusworkspaceoncurrentmonitor, 5
bind = Super, 6, focusworkspaceoncurrentmonitor, 6
bind = Super, 7, focusworkspaceoncurrentmonitor, 7
bind = Super, 8, focusworkspaceoncurrentmonitor, 8
bind = Super, 9, focusworkspaceoncurrentmonitor, 9
bind = Super, 0, focusworkspaceoncurrentmonitor, 10

bind = Super+Shift, 1, workspace, 1
bind = Super+Shift, 2, workspace, 2
bind = Super+Shift, 3, workspace, 3
bind = Super+Shift, 4, workspace, 4
bind = Super+Shift, 5, workspace, 5
bind = Super+Shift, 6, workspace, 6
bind = Super+Shift, 7, workspace, 7
bind = Super+Shift, 8, workspace, 8
bind = Super+Shift, 9, workspace, 9
bind = Super+Shift, 0, workspace, 10

# zoom
bind = Ctrl+Super+Alt, mouse_down, exec, hyprctl keyword cursor:zoom_factor $(hyprctl -j getoption cursor:zoom_factor | jq ".float + 1.0")  # Zoom in
bind = Ctrl+Super+Alt, mouse_up, exec, hyprctl keyword cursor:zoom_factor $(hyprctl -j getoption cursor:zoom_factor |  jq "[.float + 1.0, 1.0] | min")  # Zoom out
bindc = Ctrl+Super+Alt, mouse:274, exec, hyprctl keyword cursor:zoom_factor 1.0  # Reset

# windowrules
windowrule = match:title Subway Builder, fullscreen 1
windowrule = match:class missioncenter, workspace special:sysmon
windowrule = match:class obsidian, workspace special:todo

# config ----------

workspace = 1,monitor:DP-2
workspace = 2,monitor:DP-1
workspace = 3,monitor:HDMI-A-1

#workspace = special:special, layoutopt:wslayout-layout:scrolling

# decoration
bezier = borderBezier, 1.75, 0.885, 0.32, 1.275
animation = borderangle, 1,120, borderBezier, loop

xwayland {
    force_zero_scaling = true
    enabled = true
    use_nearest_neighbor = true
}

cursor {
	no_hardware_cursors = true
    enable_hyprcursor = true
    hide_on_key_press = true
}

input {
    follow_mouse = 1
    sensitivity = -0.5
    numlock_by_default = true
}

dwindle {
    pseudotile = true
    split_bias = 1
}

master {
    new_status = master
}

render {
    direct_scanout = true
}

plugin {
    dynamic-cursors {
        # enables the plugin
        enabled = true

        # sets the cursor behaviour, supports these values:
        # tilt    - tilt the cursor based on x-velocity
        # rotate  - rotate the cursor based on movement direction
        # stretch - stretch the cursor shape based on direction and velocity
        # none    - do not change the cursors behaviour
        mode = stretch

        # minimum angle difference in degrees after which the shape is changed
        # smaller values are smoother, but more expensive for hw cursors
        threshold = 2

        # for mode = rotate
        rotate {
            # length in px of the simulated stick used to rotate the cursor
            # most realistic if this is your actual cursor size
            length = 20

            # clockwise offset applied to the angle in degrees
            # this will apply to ALL shapes
            offset = 0.0
        }

        # for mode = tilt
        tilt {
            # controls how powerful the tilt is, the lower, the more power
            # this value controls at which speed (px/s) the full tilt is reached
            limit = 5000

            # relationship between speed and tilt, supports these values:
            # linear             - a linear function is used
            # quadratic          - a quadratic function is used (most realistic to actual air drag)
            # negative_quadratic - negative version of the quadratic one, feels more aggressive
            function = negative_quadratic
        }

        # for mode = stretch
        stretch {
            # controls how much the cursor is stretched
            # this value controls at which speed (px/s) the full stretch is reached
            limit = 3000

            # relationship between speed and stretch amount, supports these values:
            # linear             - a linear function is used
            # quadratic          - a quadratic function is used
            # negative_quadratic - negative version of the quadratic one, feels more aggressive
            function = quadratic
        }

        # configure shake to find
        # magnifies the cursor if its is being shaken
        shake {
            # enables shake to find
            enabled = true

            # use nearest-neighbour (pixelated) scaling when shaking
            # may look weird when effects are enabled
            nearest = true

            # controls how soon a shake is detected
            # lower values mean sooner
            threshold = 6.0

            # magnification level immediately after shake start
            base = 4.0
            # magnification increase per second when continuing to shake
            speed = 4.0
            # how much the speed is influenced by the current shake intensitiy
            influence = 0.0

            # maximal magnification the cursor can reach
            # values below 1 disable the limit (e.g. 0)
            limit = 0.0

            # time in millseconds the cursor will stay magnified after a shake has ended
            timeout = 1000

            # show cursor behaviour `tilt`, `rotate`, etc. while shaking
            effects = false

            # enable ipc events for shake
            # see the `ipc` section below
            ipc = false
        }
    }

    # use hyprcursor to get a higher resolution texture when the cursor is magnified
    # see the `hyprcursor` section below
    hyprcursor {
        # use nearest-neighbour (pixelated) scaling when magnifing beyond texture size
        # this will also have effect without hyprcursor support being enabled
        # 0 / false - never use pixelated scaling
        # 1 / true  - use pixelated when no highres image
        # 2         - always use pixleated scaling
        nearest = true

        # enable dedicated hyprcursor support
        enabled = true

        # resolution in pixels to load the magnified shapes at
        # be warned that loading a very high-resolution image will take a long time and might impact memory consumption
        # -1 means we use [normal cursor size] * [shake:base option]
        resolution = -1

        # shape to use when clientside cursors are being magnified
        # see the shape-name property of shape rules for possible names
        # specifying clientside will use the actual shape, but will be pixelated
        fallback = clientside
    }

    hyprscrolling {
        column_width = 0.7
    }

    wslayout {
        default_layout = dwindle
    }
}

general {
    layout = workspacelayout
}

# system startup - leave these lines at the bottom of the file ----------
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP # for XDPH
exec-once = dbus-update-activation-environment --systemd --all # for XDPH
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP # for XDPH
exec-once = hyprpm reload -n

# repair discord
exec-once = sudo Equilotl -repair -location /opt/discord

# startup apps
exec-once = arch-update --tray
exec-once = trayscale --hide-window
exec-once = openrgb --startminimized -p pink # start openrgb as tray icon
exec-once = sunshine
exec-once = go-hass-agent run